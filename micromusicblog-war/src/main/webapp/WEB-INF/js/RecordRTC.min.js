function RecordRTC(a,b){function c(){console.debug("started recording "+(IsChrome?b.type:"audio+video")+" stream.");var c=IsChrome?window.StereoRecorder:window.MediaStreamRecorder;return"video"==b.type&&(c=window.WhammyRecorder),"gif"==b.type&&(c=window.GifRecorder),"canvas"==b.type&&(c=window.CanvasRecorder),g=new c(a),g=mergeProps(g,b),g.record(),this}function d(a){function c(){if(a&&g){var c=URL.createObjectURL(g.recordedBlob);a(c)}b.autoWriteToDisk&&e(function(a){var c={};c[b.type+"Blob"]=a,DiskStorage.Store(c)})}return g?(console.warn("stopped recording "+(IsChrome?b.type:"audio+video")+" stream."),"audio"==b.type&&!IsChrome||"video"==b.type&&IsChrome?g.stop(c):(g.stop(),c()),void 0):console.warn(f)}function e(a,b){function c(){if(window.Worker){var c=d(function(a){postMessage((new FileReaderSync).readAsDataURL(a))});c.onmessage=function(b){a(b.data)},c.postMessage(b?b.recordedBlob:g.recordedBlob)}else{var e=new FileReader;e.readAsDataURL(b?b.recordedBlob:g.recordedBlob),e.onload=function(b){a(b.target.result)}}}function d(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {readFile(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}if(!a)throw"Pass a callback function over getDataURL.";c()}if(b=b||{},!a)throw"MediaStream is mandatory.";b.type||(b.type="audio");var g,f='It seems that "startRecording" is not invoked for '+b.type+" recorder.";return{startRecording:c,stopRecording:d,getBlob:function(){return g?g.recordedBlob:console.warn(f)},getDataURL:e,toURL:function(){return g?URL.createObjectURL(g.recordedBlob):console.warn(f)},save:function(){return g?(console.log("saving recorded "+b.type+" stream to disk!"),this.getDataURL(function(a){var b=document.createElement("a");b.href=a,b.target="_blank",b.download=Math.round(9999999999*Math.random())+888888888+"."+g.recordedBlob.type.split("/")[1];var c=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});b.dispatchEvent(c),(window.URL||window.webkitURL).revokeObjectURL(b.href)}),void 0):console.warn(f)},getFromDisk:function(a){return g?(RecordRTC.getFromDisk(b.type,a),void 0):console.warn(f)},setAdvertisementArray:function(a){this.advertisement=[];for(var b=a.length,c=0;b>c;c++)this.advertisement.push({duration:c,image:a[c]})}}}function MRecordRTC(a){this.addStream=function(b){b&&(a=b)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){this.mediaType.audio&&(this.audioRecorder=RecordRTC(a,this).startRecording()),this.mediaType.video&&(this.videoRecorder=RecordRTC(a,{type:"video"}).startRecording()),this.mediaType.gif&&(this.gifRecorder=RecordRTC(a,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10}).startRecording())},this.stopRecording=function(a){a=a||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(b){a(b,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(b){a(b,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(b){a(b,"gif")})},this.getBlob=function(a){var b={};this.audioRecorder&&(b.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(b.video=this.videoRecorder.getBlob()),this.gifRecorder&&(b.gif=this.gifRecorder.getBlob()),a&&a(b)},this.getDataURL=function(a){function b(a,b){if(window.Worker){var d=c(function(a){postMessage((new FileReaderSync).readAsDataURL(a))});d.onmessage=function(a){b(a.data)},d.postMessage(a)}}function c(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {readFile(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}this.getBlob(function(c){b(c.audio,function(d){b(c.video,function(b){a({audio:d,video:b})})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})}}function mergeProps(a,b){b=reformatProps(b);for(var c in b)"function"!=typeof b[c]&&(a[c]=b[c]);return a}function reformatProps(a){var b={};for(var c in a)if(-1!=c.indexOf("-")){var d=c.split("-"),e=d[0]+d[1].split("")[0].toUpperCase()+d[1].substr(1);b[e]=a[c]}else b[c]=a[c];return b}function MediaStreamRecorder(a){var b=this,c=!1;this.record=function(){d=new MediaRecorder(a),d.ondataavailable=function(a){if(!c){if(console.log(a.data.type,a.data),!a.data.size)return console.warn("Recording of",a.data.type,"failed."),void 0;c=!0,b.recordedBlob=new Blob([a.data],{type:a.data.type||"audio/ogg"}),b.callback()}},d.onerror=function(a){console.warn(a),d.stop(),b.record(0)},d.start(0)},this.stop=function(a){this.callback=a,"recording"==d.state&&(d.requestData(),d.stop())};var d}function StereoRecorder(a){this.record=function(){b=new StereoAudioRecorder(a,this),b.record()},this.stop=function(){b&&b.stop(),this.recordedBlob=b.recordedBlob};var b}function StereoAudioRecorder(a,b){function g(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;c>f;)d[f++]=a[e],d[f++]=b[e],e++;return d}function h(a,b){for(var c=new Float32Array(b),d=0,e=a.length,f=0;e>f;f++){var g=a[f];c.set(g,d),d+=g.length}return c}function i(a,b,c){for(var d=c.length,e=0;d>e;e++)a.setUint8(b+e,c.charCodeAt(e))}var c=[],d=[],e=!1,f=0;this.record=function(){e=!0,c.length=d.length=0,f=0},this.stop=function(){e=!1;var a=h(c,f),b=h(d,f),j=g(a,b),k=new ArrayBuffer(44+2*j.length),m=new DataView(k);i(m,0,"RIFF"),m.setUint32(4,44+2*j.length,!0),i(m,8,"WAVE"),i(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,2,!0),m.setUint32(24,p,!0),m.setUint32(28,4*p,!0),m.setUint16(32,4,!0),m.setUint16(34,16,!0),i(m,36,"data"),m.setUint32(40,2*j.length,!0);var n=j.length,o=44;l=1;for(var q=0;n>q;q++)m.setInt16(o,j[q]*32767*l,!0),o+=2;this.recordedBlob=new Blob([m],{type:"audio/wav"}),this.length=f};var j=Storage.AudioContext;Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new j);var k=Storage.AudioContextConstructor;Storage.VolumeGainNode||(Storage.VolumeGainNode=k.createGain());var l=Storage.VolumeGainNode;Storage.AudioInput||(Storage.AudioInput=k.createMediaStreamSource(a));var m=Storage.AudioInput;m.connect(l);var n=[256,512,1024,2048,4096,8192,16384],o=b.bufferSize||4096;if(-1==n.indexOf(o))throw"Legal values for buffer-size are "+JSON.stringify(n,null,"	");var p=b.sampleRate||k.sampleRate||44100;if(22050>p||p>96e3)throw"sample-rate must be under range 22050 and 96000.";if(console.log("sample-rate",p),console.log("buffer-size",o),k.createJavaScriptNode)__stereoAudioRecorderJavacriptNode=k.createJavaScriptNode(o,2,2);else{if(!k.createScriptProcessor)throw"WebAudio API has no support on this browser.";__stereoAudioRecorderJavacriptNode=k.createScriptProcessor(o,2,2)}__stereoAudioRecorderJavacriptNode.onaudioprocess=function(a){if(e){var b=a.inputBuffer.getChannelData(0),g=a.inputBuffer.getChannelData(1);c.push(new Float32Array(b)),d.push(new Float32Array(g)),f+=o}},l.connect(__stereoAudioRecorderJavacriptNode),__stereoAudioRecorderJavacriptNode.connect(k.destination)}function CanvasRecorder(a){function c(){html2canvas(a,{onrendered:function(a){d.add(a),b&&requestAnimationFrame(c)}})}if(!window.html2canvas)throw"Please link: //www.webrtc-experiment.com/screenshot.js";var b;this.record=function(){b=!0,c()},this.stop=function(){b=!1,this.recordedBlob=d.compile(),d.frames=[]};var d=new Whammy.Video(100)}function WhammyRecorder(a){function c(){var a=(new Date).getTime()-h;return h=(new Date).getTime(),a?(f.drawImage(g,0,0,e.width,e.height),b.push({duration:a,image:e.toDataURL("image/webp")}),d||setTimeout(c,10),void 0):c()}this.record=function(){this.width||(this.width=g.offsetWidth||320),this.height||(this.height=g.offsetHeight||240),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),e.width=this.canvas.width,e.height=this.canvas.height,g.width=this.video.width,g.height=this.video.height,c()};var b=[];this.advertisement&&(b=advertisement);var d=!1;this.stop=function(a){d=!0,i.frames=b,b=[],this.recordedBlob=i.compile(),a&&a(this.recordedBlob)};var e=document.createElement("canvas"),f=e.getContext("2d"),g=document.createElement("video");g.muted=!0,g.volume=0,g.autoplay=!0,g.src=URL.createObjectURL(a),g.play();var h=(new Date).getTime(),i=new Whammy.Video}function GifRecorder(a){this.record=function(){function a(f){e=requestAnimationFrame(a),void 0===typeof h&&(h=f),90>f-h||(c.drawImage(d,0,0,b.width,b.height),i.addFrame(c),h=f)}this.width||(this.width=d.offsetWidth||320),this.height||(this.height=d.offsetHeight||240),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),b.width=this.canvas.width,b.height=this.canvas.height,d.width=this.video.width,d.height=this.video.height,i=new GIFEncoder,i.setRepeat(0),i.setDelay(this.frameRate||200),i.setQuality(this.quality||10),i.start(),f=Date.now(),e=requestAnimationFrame(a)},this.stop=function(){e&&cancelAnimationFrame(e),g=Date.now(),this.recordedBlob=new Blob([new Uint8Array(i.stream().bin)],{type:"image/gif"}),i.stream().bin=[]};var b=document.createElement("canvas"),c=b.getContext("2d"),d=document.createElement("video");d.muted=!0,d.autoplay=!0,d.src=URL.createObjectURL(a),d.play();var f,g,h,i,e=null}function encode64(a){for(var f,g,h,i,j,k,l,b="",c=0,d=a.length,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";d>c;)f=a.charCodeAt(c++),g=a.charCodeAt(c++),h=a.charCodeAt(c++),i=f>>2,j=(3&f)<<4|g>>4,k=(15&g)<<2|h>>6,l=63&h,isNaN(g)?k=l=64:isNaN(h)&&(l=64),b=b+e.charAt(i)+e.charAt(j)+e.charAt(k)+e.charAt(l);return b}RecordRTC.getFromDisk=function(a,b){if(!b)throw"callback is mandatory.";console.log("Getting recorded "+("all"==a?"blobs":a+" blob ")+" from disk!"),DiskStorage.Fetch(function(c,d){"all"!=a&&d==a+"Blob"&&b&&b(c),"all"==a&&b&&b(c,d.replace("Blob",""))})},RecordRTC.writeToDisk=function(a){console.log("Writing recorded blob(s) to disk!"),a=a||{},a.audio&&a.video&&a.gif?a.audio.getDataURL(function(b){a.video.getDataURL(function(c){a.gif.getDataURL(function(a){DiskStorage.Store({audioBlob:b,videoBlob:c,gifBlob:a})})})}):a.audio&&a.video?a.audio.getDataURL(function(b){a.video.getDataURL(function(a){DiskStorage.Store({audioBlob:b,videoBlob:a})})}):a.audio&&a.gif?a.audio.getDataURL(function(b){a.gif.getDataURL(function(a){DiskStorage.Store({audioBlob:b,gifBlob:a})})}):a.video&&a.gif?a.video.getDataURL(function(b){a.gif.getDataURL(function(a){DiskStorage.Store({videoBlob:b,gifBlob:a})})}):a.audio?a.audio.getDataURL(function(a){DiskStorage.Store({audioBlob:a})}):a.video?a.video.getDataURL(function(a){DiskStorage.Store({videoBlob:a})}):a.gif&&a.gif.getDataURL(function(a){DiskStorage.Store({gifBlob:a})})},MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame,AudioContext=window.webkitAudioContext||window.mozAudioContext,URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.webkitMediaStream&&(window.MediaStream=window.webkitMediaStream),IsChrome=!!navigator.webkitGetUserMedia;var Storage={AudioContext:window.AudioContext||window.webkitAudioContext},__stereoAudioRecorderJavacriptNode,Whammy=function(){function a(a){for(var c=b(a),d=3e4,e=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:l(c.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:c.width,id:176},{data:c.height,id:186}]}]}]}]}],g=0,h=0;g<a.length;){var j=[],k=0;do j.push(a[g]),k+=a[g].duration,g++;while(g<a.length&&d>k);var m=0,n={id:524531317,data:[{data:h,id:231}].concat(j.map(function(a){var b=i({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(m)});return m+=a.duration,{data:b,id:163}}))};e[1].data.push(n),h+=k}return f(e)}function b(a){if(!a[0])return console.warn("Something went wrong. Maybe WebP format is not supported in the current browser."),void 0;for(var b=a[0].width,c=a[0].height,d=a[0].duration,e=1;e<a.length;e++)d+=a[e].duration;return{duration:d,width:b,height:c}}function c(a){for(var b=[];a>0;)b.push(255&a),a>>=8;return new Uint8Array(b.reverse())}function d(a){return new Uint8Array(a.split("").map(function(a){return a.charCodeAt(0)}))}function e(a){var b=[],c=a.length%8?new Array(9-a.length%8).join("0"):"";a=c+a;for(var d=0;d<a.length;d+=8)b.push(parseInt(a.substr(d,8),2));return new Uint8Array(b)}function f(a){for(var b=[],g=0;g<a.length;g++){var h=a[g].data;"object"==typeof h&&(h=f(h)),"number"==typeof h&&(h=e(h.toString(2))),"string"==typeof h&&(h=d(h));var i=h.size||h.byteLength||h.length,j=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),k=i.toString(2),l=new Array(7*j+7+1-k.length).join("0")+k,m=new Array(j).join("0")+"1"+l;b.push(c(a[g].id)),b.push(e(m)),b.push(h)}return new Blob(b,{type:"video/webm"})}function i(a){var b=0;if(a.keyframe&&(b|=128),a.invisible&&(b|=8),a.lacing&&(b|=a.lacing<<1),a.discardable&&(b|=1),a.trackNum>127)throw"TrackNumber > 127 not supported";var c=[128|a.trackNum,a.timecode>>8,255&a.timecode,b].map(function(a){return String.fromCharCode(a)}).join("")+a.frame;return c}function j(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("\x9d*"),d=0,e=[];4>d;d++)e[d]=b.charCodeAt(c+3+d);var f,g,h;return h=e[1]<<8|e[0],f=16383&h,h=e[3]<<8|e[2],g=16383&h,{width:f,height:g,data:b,riff:a}}function k(a){for(var b=0,c={};b<a.length;){var d=a.substr(b,4),e=parseInt(a.substr(b+4,4).split("").map(function(a){var b=a.charCodeAt(0).toString(2);return new Array(8-b.length+1).join("0")+b}).join(""),2),f=a.substr(b+4+4,e);b+=8+e,c[d]=c[d]||[],"RIFF"==d||"LIST"==d?c[d].push(k(f)):c[d].push(f)}return c}function l(a){return[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}function m(a){this.frames=[],this.duration=a||1,this.quality=100}return m.prototype.add=function(a,b){if("canvas"in a&&(a=a.canvas),"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:b||this.duration})},m.prototype.compile=function(){return new a(this.frames.map(function(a){var b=j(k(atob(a.image.slice(23))));return b.duration=a.duration,b}))},{Video:m,toWebM:a}}(),DiskStorage={init:function(){function g(b){b.createObjectStore(a.dataStoreName)}function h(){function c(c){b.objectStore(a.dataStoreName).get(c).onsuccess=function(b){a.callback&&a.callback(b.target.result,c)}}var b=e.transaction([a.dataStoreName],"readwrite");a.videoBlob&&b.objectStore(a.dataStoreName).put(a.videoBlob,"videoBlob"),a.gifBlob&&b.objectStore(a.dataStoreName).put(a.gifBlob,"gifBlob"),a.audioBlob&&b.objectStore(a.dataStoreName).put(a.audioBlob,"audioBlob"),c("audioBlob"),c("videoBlob"),c("gifBlob")}var e,a=this,b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,c=1,d=location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),f=b.open(d,c);f.onerror=a.onError,f.onsuccess=function(){if(e=f.result,e.onerror=a.onError,e.setVersion)if(e.version!=c){var b=e.setVersion(c);b.onsuccess=function(){g(e),h()}}else h();else h()},f.onupgradeneeded=function(a){g(a.target.result)}},Fetch:function(a){return this.callback=a,this.init(),this},Store:function(a){return this.audioBlob=a.audioBlob,this.videoBlob=a.videoBlob,this.gifBlob=a.gifBlob,this.init(),this},onError:function(a){console.error(JSON.stringify(a,null,"	"))},dataStoreName:"recordRTC"};LZWEncoder=function(){var c,d,e,f,g,h,k,m,t,u,v,z,a={},b=-1,i=12,j=5003,l=i,n=1<<i,o=[],p=[],q=j,r=0,s=!1,w=0,x=0,y=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],A=[],B=a.LZWEncoder=function(a,b,g,h){c=a,d=b,e=g,f=Math.max(2,h)},C=function(a,b){A[z++]=a,z>=254&&H(b)},D=function(a){E(q),r=u+2,s=!0,K(u,a)},E=function(a){for(var b=0;a>b;++b)o[b]=-1},F=a.compress=function(a,c){var d,e,f,g,h,i,j;for(t=a,s=!1,k=t,m=I(k),u=1<<a-1,v=u+1,r=u+2,z=0,g=J(),j=0,d=q;65536>d;d*=2)++j;j=8-j,i=q,E(i),K(u,c);a:for(;(f=J())!=b;)if(d=(f<<l)+g,e=f<<j^g,o[e]!=d){if(o[e]>=0){h=i-e,0==e&&(h=1);do if((e-=h)<0&&(e+=i),o[e]==d){g=p[e];continue a}while(o[e]>=0)}K(g,c),g=f,n>r?(p[e]=r++,o[e]=d):D(c)}else g=p[e];K(g,c),K(v,c)},H=(a.encode=function(a){a.writeByte(f),g=c*d,h=0,F(f+1,a),a.writeByte(0)},function(a){z>0&&(a.writeByte(z),a.writeBytes(A,0,z),z=0)}),I=function(a){return(1<<a)-1},J=function(){if(0==g)return b;--g;var a=e[h++];return 255&a},K=function(a,b){for(w&=y[x],x>0?w|=a<<x:w=a,x+=k;x>=8;)C(255&w,b),w>>=8,x-=8;if((r>m||s)&&(s?(m=I(k=t),s=!1):(++k,m=k==l?n:I(k))),a==v){for(;x>0;)C(255&w,b),w>>=8,x-=8;H(b)}};return B.apply(this,arguments),a},NeuQuant=function(){var y,D,E,F,G,a={},b=256,c=499,d=491,e=487,f=503,g=3*f,h=b-1,i=4,j=100,k=16,l=1<<k,m=10,o=10,p=l>>o,q=l<<m-o,r=b>>3,s=6,t=1<<s,u=r*t,v=30,w=10,x=1<<w,z=8,A=1<<z,B=w+z,C=1<<B,H=[],I=[],J=[],K=[],L=a.NeuQuant=function(a,c,d){var e,f;for(D=a,E=c,F=d,G=new Array(b),e=0;b>e;e++)G[e]=new Array(4),f=G[e],f[0]=f[1]=f[2]=(e<<i+8)/b,J[e]=l/b,I[e]=0},M=function(){for(var d,e,f,a=[],c=new Array(b),g=0;b>g;g++)c[G[g][3]]=g;for(d=0,e=0;b>e;e++)f=c[e],a[d++]=G[f][0],a[d++]=G[f][1],a[d++]=G[f][2];return a},N=function(){var a,c,d,e,f,g,i,j;for(i=0,j=0,a=0;b>a;a++){for(f=G[a],d=a,e=f[1],c=a+1;b>c;c++)g=G[c],g[1]<e&&(d=c,e=g[1]);if(g=G[d],a!=d&&(c=g[0],g[0]=f[0],f[0]=c,c=g[1],g[1]=f[1],f[1]=c,c=g[2],g[2]=f[2],f[2]=c,c=g[3],g[3]=f[3],f[3]=c),e!=i){for(H[i]=j+a>>1,c=i+1;e>c;c++)H[c]=a;i=e,j=a}}for(H[i]=j+h>>1,c=i+1;256>c;c++)H[c]=h},O=function(){var a,b,h,k,l,m,n,o,p,q,r,t,w,z;for(g>E&&(F=1),y=30+(F-1)/3,t=D,w=0,z=E,r=E/(3*F),q=0|r/j,o=x,m=u,n=m>>s,1>=n&&(n=0),a=0;n>a;a++)K[a]=o*((n*n-a*a)*A/(n*n));for(p=g>E?3:0!=E%c?3*c:0!=E%d?3*d:0!=E%e?3*e:3*f,a=0;r>a;)if(h=(255&t[w+0])<<i,k=(255&t[w+1])<<i,l=(255&t[w+2])<<i,b=U(h,k,l),T(o,b,h,k,l),0!=n&&S(n,b,h,k,l),w+=p,w>=z&&(w-=E),a++,0==q&&(q=1),0==a%q)for(o-=o/y,m-=m/v,n=m>>s,1>=n&&(n=0),b=0;n>b;b++)K[b]=o*((n*n-b*b)*A/(n*n))},R=(a.map=function(a,c,d){var e,f,g,h,i,j,k;for(i=1e3,k=-1,e=H[c],f=e-1;b>e||f>=0;)b>e&&(j=G[e],g=j[1]-c,g>=i?e=b:(e++,0>g&&(g=-g),h=j[0]-a,0>h&&(h=-h),g+=h,i>g&&(h=j[2]-d,0>h&&(h=-h),g+=h,i>g&&(i=g,k=j[3])))),f>=0&&(j=G[f],g=c-j[1],g>=i?f=-1:(f--,0>g&&(g=-g),h=j[0]-a,0>h&&(h=-h),g+=h,i>g&&(h=j[2]-d,0>h&&(h=-h),g+=h,i>g&&(i=g,k=j[3]))));return k},a.process=function(){return O(),R(),N(),M()},function(){for(var c=0;b>c;c++)G[c][0]>>=i,G[c][1]>>=i,G[c][2]>>=i,G[c][3]=c}),S=function(a,c,d,e,f){var g,h,i,j,k,l,m;for(i=c-a,-1>i&&(i=-1),j=c+a,j>b&&(j=b),g=c+1,h=c-1,l=1;j>g||h>i;){if(k=K[l++],j>g){m=G[g++];try{m[0]-=k*(m[0]-d)/C,m[1]-=k*(m[1]-e)/C,m[2]-=k*(m[2]-f)/C}catch(n){}}if(h>i){m=G[h--];try{m[0]-=k*(m[0]-d)/C,m[1]-=k*(m[1]-e)/C,m[2]-=k*(m[2]-f)/C}catch(n){}}}},T=function(a,b,c,d,e){var f=G[b];f[0]-=a*(f[0]-c)/x,f[1]-=a*(f[1]-d)/x,f[2]-=a*(f[2]-e)/x},U=function(a,c,d){var e,f,g,h,j,l,n,r,s,t;for(r=2147483647,s=r,l=-1,n=l,e=0;b>e;e++)t=G[e],f=t[0]-a,0>f&&(f=-f),g=t[1]-c,0>g&&(g=-g),f+=g,g=t[2]-d,0>g&&(g=-g),f+=g,r>f&&(r=f,l=e),h=f-(I[e]>>k-i),s>h&&(s=h,n=e),j=J[e]>>o,J[e]-=j,I[e]+=j<<m;return J[l]+=p,I[l]-=q,n};return L.apply(this,arguments),a},GIFEncoder=function(){function a(){this.bin=[]}for(var b=0,c={};256>b;b++)c[b]=String.fromCharCode(b);a.prototype.getData=function(){for(var a="",b=this.bin.length,d=0;b>d;d++)a+=c[this.bin[d]];return a},a.prototype.writeByte=function(a){this.bin.push(a)},a.prototype.writeUTFBytes=function(a){for(var b=a.length,c=0;b>c;c++)this.writeByte(a.charCodeAt(c))},a.prototype.writeBytes=function(a,b,c){for(var d=c||a.length,e=b||0;d>e;e++)this.writeByte(a[e])};var e,f,h,l,m,n,o,p,q,d={},g=null,i=-1,j=0,k=!1,r=[],s=7,t=-1,u=!1,v=!0,w=!1,x=10,E=(d.setDelay=function(a){j=Math.round(a/10)},d.setDispose=function(a){a>=0&&(t=a)},d.setRepeat=function(a){a>=0&&(i=a)},d.setTransparent=function(a){g=a},d.addFrame=function(a,b){if(null==a||!k||null==l)throw new Error("Please call start method before calling addFrame");var c=!0;try{b?m=a:(m=a.getImageData(0,0,a.canvas.width,a.canvas.height).data,w||H(a.canvas.width,a.canvas.height)),M(),K(),v&&(P(),R(),i>=0&&Q()),N(),O(),v||R(),T(),v=!1}catch(d){c=!1}return c},d.finish=function(){if(!k)return!1;var a=!0;k=!1;try{l.writeByte(59)}catch(b){a=!1}return a},function(){h=0,m=null,n=null,o=null,q=null,u=!1,v=!0}),H=(d.setFrameRate=function(a){15!=a&&(j=Math.round(100/a))},d.setQuality=function(a){1>a&&(a=1),x=a},d.setSize=function(a,b){(!k||v)&&(e=a,f=b,1>e&&(e=320),1>f&&(f=240),w=!0)}),K=(d.start=function(){E();var b=!0;u=!1,l=new a;try{l.writeUTFBytes("GIF89a")}catch(c){b=!1}return k=b},d.cont=function(){E();var b=!0;return u=!1,l=new a,k=b},function(){var c,d,e,f,a=n.length,b=a/3;for(o=[],c=new NeuQuant(n,a,x),q=c.process(),d=0,e=0;b>e;e++)f=c.map(255&n[d++],255&n[d++],255&n[d++]),r[f]=!0,o[e]=f;n=null,p=8,s=7,null!=g&&(h=L(g))}),L=function(a){var b;if(null==q)return-1;var c=(16711680&a)>>16,d=(65280&a)>>8,e=255&a,f=0,g=16777216,h=q.length;for(b=0;h>b;){var i=c-(255&q[b++]),j=d-(255&q[b++]),k=e-(255&q[b]),l=i*i+j*j+k*k,m=b/3;r[m]&&g>l&&(g=l,f=m),b++}return f},M=function(){var c,d,g,h,i,a=e,b=f;for(n=[],c=m,d=0,g=0;b>g;g++)for(h=0;a>h;h++)i=4*g*a+4*h,n[d++]=c[i],n[d++]=c[i+1],n[d++]=c[i+2]},N=function(){l.writeByte(33),l.writeByte(249),l.writeByte(4);var a,b;null==g?(a=0,b=0):(a=1,b=2),t>=0&&(b=7&t),b<<=2,l.writeByte(0|(0|b)|a),S(j),l.writeByte(h),l.writeByte(0)},O=function(){l.writeByte(44),S(0),S(0),S(e),S(f),v?l.writeByte(0):l.writeByte(128|s)},P=function(){S(e),S(f),l.writeByte(240|s),l.writeByte(0),l.writeByte(0)},Q=function(){l.writeByte(33),l.writeByte(255),l.writeByte(11),l.writeUTFBytes("NETSCAPE2.0"),l.writeByte(3),l.writeByte(1),S(i),l.writeByte(0)},R=function(){var a,b;for(l.writeBytes(q),a=768-q.length,b=0;a>b;b++)l.writeByte(0)},S=function(a){l.writeByte(255&a),l.writeByte(255&a>>8)},T=function(){var a=new LZWEncoder(e,f,o,p);a.encode(l)};return d.stream=function(){return l},d.setProperties=function(a,b){k=a,v=b},d};